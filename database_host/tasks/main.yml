- name: disable selinux
  selinux:
    policy=targeted
    state=disabled
  notify:
    - restart server
    - wait for server to restart

- name: disable iptables
  service:
    name=iptables
    state=stopped
    enabled=no
  when: ansible_os_family == 'RedHat' and ansible_distribution_major_version == '6'

- name: disable firewalld
  service:
    name=firewalld
    state=stopped
    enabled=no
  when: ansible_os_family == 'RedHat' and ansible_distribution_major_version == '7'

- name: install packages linux 6
  yum:
    name={{ item }}
    state=present
  with_items:
    - binutils
    - compat-libcap1
    - compat-libstdc++-33
    - gcc
    - gcc-c++
    - glibc
    - glibc-devel
    - ksh
    - libaio
    - libaio-devel
    - libgcc
    - libstdc++
    - libstdc++-devel
    - libxcb
    - libX11
    - libXau
    - libXext
    - libXi
    - libXtst
    - make
    - sysstat
  when: ansible_os_family == 'RedHat' and ansible_distribution_major_version == '6'

- name: Install wget package (RedHat based)
    action: yum name='wget' state=installed

- name: Download public-yum-el7.repo
     get_url:
       url: http://public-yum.oracle.com/public-yum-el7.repo
       dest:/etc/yum.repos.d/public-yum-el7.repo
       mode: 0750

- name: Download RPM-GPG-KEY-oracle-ol7
      get_url:
        url: http://public-yum.oracle.com/RPM-GPG-KEY-oracle-ol7
        dest:/etc/pki/rpm-gpg/RPM-GPG-KEY-oracle
        mode: 0750
       when: ansible_os_family == 'RedHat' and ansible_distribution_major_version == '7'

- name: create group
  group:
    name={{ oracle_install_group }}
    gid={{ oracle_install_group_id }}
    state=present

- name: create user
  user:
    name={{ oracle_install_user }}
    state=present
    createhome=yes
    group={{ oracle_install_group_id }}
    password={{ oracle_install_password }}

- template:
    src=roles/database_common/templates/linux/sysctl_conf.j2
    dest=/etc/sysctl.conf
    owner=root
    group=root
    mode=0644

- template:
    src=roles/database_common/templates/linux/limits_conf.j2
    dest=/etc/security/limits.conf
    owner=root
    group=root
    mode=0644

- name:  User | Add group(s)
  group: name={{ item.group }} gid={{ item.gid }} state=present
    with_items: "{{oracle_groups}}"
    tags:
     - group

- name: User | Add Oracle user
  user: name={{ item.username }}  group={{ item.primgroup }} groups={{ item.othergroups }} uid={{ item.uid }} generate_ssh_key=yes append=yes state=present password={{ item.passwd }}
    with_items: "{{oracle_users}}"
    tags:
    - user

